<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <link rel="stylesheet" href="static/css/play.css">
  </head>
  <body>
    <div id="app">
          <!--<div id="box">-->
            <!--<span class="boxDetails" id="boxTitle">Box title: {{ box.box.name }}</span><br />-->
            <!--<span class="boxDetails" id="owner">Owner: {{ box.box.owner }}</span><br />-->
            <!--<span class="boxDetails" id="verbCount">VerbCount: {{ box.box.verbCount }}</span><br />-->
            <!--<span class="boxDetails" id="fromTo">Type: {{ box.box.front }} - {{ box.box.back }}</span><br />-->
            <!--<span class="boxDetails" id="isPublic">Is Public: {{ box.box.public }}</span><br />-->
          <!--</div>-->
        <div id="loadPlayHolder" v-bind:class="{'is-collapsed' : collapsedLoadPlayHolder }">
            <div class="loader"></div>
        </div>
      <div id="startPlayHolder" v-bind:class="{'is-collapsed' : collapsedStartPlayHolder }">
        <button v-on:click="startPlay">Play</button>
      </div>
      <div id="playHolder" v-bind:class="{'is-collapsed' : collapsedPlayHolder }">
        <div id="verbsHolder">
          <h1> {{sideA}} </h1>
          <h1> {{sideB}} </h1>
        </div>
        <div id="showVerbHolder" v-bind:class="{'is-collapsed' : collapsedShowVerbHolder }">
          <button v-on:click="showVerb">Show</button>
        </div>
        <div id="correctWrongHolder" v-bind:class="{'is-collapsed' : collapsedCorrectWrongHolder }">
          <button v-on:click="markedCorrect">Correct</button>
          <button v-on:click="markedWrong">Wrong</button>
        </div>
      </div>
    </div>
    <script>
        var app = new Vue({
            el: '#app',
            mounted: function() {
                this.loadPlay();
            },
            methods: {
                loadPlay: function() {
                    var XMLReq = new XMLHttpRequest();
                    XMLReq.open("GET", "http://localhost:8080/vb/api/play/1826", true);
                    XMLReq.setRequestHeader("Authorization", "Basic " + btoa("admin:123"));
                    XMLReq.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                    XMLReq.onload = function (vm) {
                        console.info("On load...");
                        if (this.readyState === 4 && this.status === 200) {
                            vm.box = JSON.parse(this.responseText);
                            vm.collapsedLoadPlayHolder = true;
                            vm.collapsedStartPlayHolder = false;
                        }
                    }.bind(XMLReq, this);
                    console.info("Sending...");
                    XMLReq.send();
                },
                loadNextVerb: function() {
                    this.currentIndex++;
                    if (this.box.verbPlayList.length <= this.currentIndex) {
                        alert("Box completed!");
                        this.startPlay();
                    } else {
                        this.sideA = this.box.verbPlayList[this.currentIndex].verb.front;
                        this.sideB = "-";
                    }
                    this.collapsedStartPlayHolder = true;
                    this.collapsedPlayHolder      = false;
                    this.collapsedShowVerbHolder  = false;
                    this.collapsedCorrectWrongHolder = true;
                },
                markedCorrect: function() {
                    this.loadNextVerb()
                },
                markedWrong: function() {
                    this.loadNextVerb()

                },
                startPlay: function() {
                    console.info("Start play...");
                    this.currentIndex = -1;
                    this.loadNextVerb();
                },
                showVerb: function() {
                    this.sideB = this.box.verbPlayList[this.currentIndex].verb.back;
                    this.collapsedShowVerbHolder = true;
                    this.collapsedCorrectWrongHolder = false;
                }
            },
            data: {
                verbPlayList: null,
                collapsedLoadPlayHolder: false,
                collapsedStartPlayHolder: true,
                collapsedPlayHolder: true,
                collapsedShowVerbHolder: true,
                collapsedCorrectWrongHolder: true,
                sideA: "-",
                sideB: "-",
                currentIndex: null,
                box: null
            }
        })
    </script>
  </body>
</html>